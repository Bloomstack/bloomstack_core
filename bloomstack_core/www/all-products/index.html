{% extends "templates/web.html" %}

{% block title %}{{ _('Products') }}{% endblock %}

{% block style %}
<link rel="stylesheet" href="https://use.typekit.net/ybv2gcc.css">
<link rel="stylesheet" href="/assets/bloomstack_core/css/products.css">
{% endblock %}

{% block page_content %}
<div class="row page-header">
	<div class="col-1">
		<p></p>
	</div>
	<div class="col-md-11 col-sm-12 col-xs-12">
		<h1>{{ _('Products') }}</h1>
	</div>
</div>

<div class="row">
	<div class="col-md-1"></div>
	<div class="col-md-5 col-sm-12 col-xs-12">
		<div class="input-group input-group-sm mb-3">
			<input type="search" class="form-control" placeholder="{{_('Search')}}"
			aria-label="{{_('Product Search')}}" aria-describedby="product-search"
			value="{{ frappe.form_dict.search or '' }}">
		</div>
	</div>
		<!-- Filters code, Need it Later 
		{% for field_filter in field_filters %}
		{%- set item_field =  field_filter[0] %}
		{%- set values =  field_filter[1] %}
		<div class="col-1">
			{% if values %}
			<select class="filter-options">
				<option value="" disabled selected>{{item_field.label}}</option>
				{% for value in values %}
				<option class="custom-control custom-checkbox" data-value="{{ value }}" id="{{value}}" data-filter-name="{{ item_field.fieldname }}" data-filter-value="{{ value }}"> {{value}} </option>
				{% endfor %}
			</select>
			{% else %}
			<i class="text-muted">{{ _('No values') }}</i>
			{% endif %}
		</div>
		{% endfor %}
		
		{% for attribute in attribute_filters %}
		<div class="col-1">
			{% if attribute.item_attribute_values %}
			<select class="filter-options">
				<option value="" disabled selected>{{ attribute.name }}</option>
				{% for attr_value in attribute.item_attribute_values %}
				<option class="custom-control custom-checkbox" data-value="{{ value }}" id="{{attr_value.name}}" data-attribute-name="{{ attribute.name }}" data-attribute-value="{{ attr_value.attribute_value }}">
					{{ attr_value.attribute_value }}
				</option>
				{% endfor %}
			</select>
			{% else %}
			<i class="text-muted">{{ _('No values') }}</i>
			{% endif %}
		</div>
		{% endfor %} -->
	<!-- <script>
		frappe.ready(() => {
			$('.filter-options').on('change', frappe.utils.debounce((e) => {
				const $input = $(e.target);
				const keyword = ($input.children("option:selected"). val() || '').toLowerCase();
				console.log(keyword);
				const $filter_options = $input;

				$filter_options.find('.custom-control').show();
				$filter_options.find('.custom-control').each((i, el) => {
					const $el = $(el);
					const value = $el.data('value').toLowerCase();
					console.log(value);
					if (!value.includes(keyword)) {
						$el.hide();
					}
				});
			}, 300));
		})
	</script> -->

	
	<!-- <div class="col-4 pl-0 d-md-none">
		<button class="btn btn-light btn-sm btn-block d-md-none"
		type="button"
		data-toggle="collapse"
		data-target="#product-filters"
		aria-expanded="false"
		aria-controls="product-filters"
		style="white-space: nowrap;"
		>
		{{ _('Toggle Filters') }}
	</button>
</div> -->
</div>

<div class="row">
	<div class="col-12 order-2 col-md-12 order-md-1 products-list row no-gutters">
		{% if items %}
		{% for item in items %}
		{% include "bloomstack_core/www/all-products/item_row.html" %}
		{% endfor %}
		{% else %}
		{% include "bloomstack_core/www/all-products/not_found.html" %}
		{% endif %}
	</div>

	
</div>

<div class="row">
	<div class="col-12">
		{% if frappe.form_dict.start|int > 0 %}
		<button class="btn btn-outline-secondary btn-prev" data-start="{{ frappe.form_dict.start|int - page_length }}">{{ _("Prev") }}</button>
		{% endif %}
		{% if items|length >= page_length %}
		<button class="btn btn-outline-secondary btn-next" data-start="{{ frappe.form_dict.start|int + page_length }}">{{ _("Next") }}</button>
		{% endif %}
	</div>
</div>

<script>
	frappe.ready(() => {
		$('.btn-prev, .btn-next').click((e) => {
			const $btn = $(e.target);
			$btn.prop('disabled', true);
			const start = $btn.data('start');
			let query_params = frappe.utils.get_query_params();
			query_params.start = start;
			let path = window.location.pathname + '?' + frappe.utils.get_url_from_dict(query_params);
			window.location.href = path;
		});
	});
</script>

{% endblock %}


